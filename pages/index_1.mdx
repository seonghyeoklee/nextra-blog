
- JPAì˜ ë°ì´í„° íƒ€ì… ì¢…ë¥˜
    - ì—”í‹°í‹° íƒ€ì…
    - ê°’ íƒ€ì…
        - ê¸°ë³¸ê°’ íƒ€ì…
            - int, String ê°™ì€ ìë°”ì˜ ê¸°ë³¸ íƒ€ì…
        - ì„ë² ë””ë“œ íƒ€ì…
            - ì‚¬ìš©ìê°€ ì§ì ‘ ì •ì˜í•œ íƒ€ì…
        - ì»¬ë ‰ì…˜ ê°’ íƒ€ì…
            - í•˜ë‚˜ ì´ìƒì˜ ê°’ íƒ€ì…

## ë‹¨ìˆœí•œ ê¸°ë³¸ê°’ íƒ€ì…

- ê°’ íƒ€ì…ì¸ name, age ì†ì„±ì€ ì‹ë³„ì ê°’ë„ ì—†ê³  ìƒëª…ì£¼ê¸°ê°€ íšŒì› ì—”í‹°í‹°ì— ì˜ì¡´í•œë‹¤.

```java
@Entity
public class Member {

	@Id
  	@GeneratedValue
	private Long id;
	private String name;
  	private int age;
}
```

### ì„ë² ë””ë“œ íƒ€ì… (ë³µí•© ê°’ íƒ€ì…)

- JPAì—ì„œëŠ” ìƒˆë¡œìš´ ê°’ íƒ€ì…ì„ ì§ì ‘ ì •ì˜í•˜ì—¬ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

```java
@Entity
public class Member {

    @Id
    @GeneratedValue
    private Long id;
    private String name;
    private int age;
    
    // ì£¼ì†Œë¥¼ í‘œí˜„
    private String city;
    private String street;
    private String zipcode;

	// ê·¼ë¬´ê¸°ê°„ì„ í‘œí˜„
	private LocalDateTime startDate;
	private LocalDateTime endDate;
}
```

```java
@Entity
public class Member {

    @Id
    @GeneratedValue
    private Long id;
    private String name;
    private int age;
    
    // ì§‘ ì£¼ì†Œë¥¼ í‘œí˜„
    private String homeCity;
    private String homeStreet;
    private String homeZipcode;

    // íšŒì‚¬ ì£¼ì†Œë¥¼ í‘œí˜„
    private String companyCity;
    private String companyStreet;
    private String companyZipcode;

	// ê·¼ë¬´ê¸°ê°„ì„ í‘œí˜„
	private LocalDateTime startDate;
	private LocalDateTime endDate;
}
```

```java
@Entity
public class Member {

    @Id
    @GeneratedValue
    private Long id;
    private String name;
    private int age;
    
    // ì§‘ ì£¼ì†Œë¥¼ í‘œí˜„
	@Embedded
    private Address homeAddress;

	// íšŒì‚¬ ì£¼ì†Œë¥¼ í‘œí˜„
	@Embedded
    private Address companyAddress;

	// ê·¼ë¬´ê¸°ê°„ì„ í‘œí˜„
	@Embedded
	private Period workPeriod;
}
```

```java
@Embeddable
public class Address {
    private String city;
    private String street;
    private String zipcode;
}
```

```java
@Embeddable
public class Period {
    private LocalDateTime startDate;
	private LocalDateTime endDate;

	public boolean isWork() {
		return ...
	}
}
```

- ê°œì„ í•œ íšŒì› ì—”í‹°í‹°ê°€ ë”ìš± ì‘ì§‘ë ¥ ìˆê³  í™•ì¥ì— ìš©ì´í•˜ë‹¤.
- @Embeddable
    - ê°’ íƒ€ì…ì„ ì •ì˜í•˜ëŠ” ê³³ì— í‘œì‹œ
- @Embedded
    - ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì— í‘œì‹œ
- ì„ë² ë””ë“œ íƒ€ì…ì€ ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜!
- ëª¨ë“  ê°’ íƒ€ì…ì€ ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸°ì— ì˜ì¡´í•¨
- ìš°ë¦¬ëŠ” ê°’ íƒ€ì…ì„ í†µí•´ ê°ì²´ì§€í–¥ ëª¨ë¸ ì„¤ê³„ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤!!

### ì„ë² ë””ë“œ íƒ€ì…ê³¼ ì—°ê´€ê´€ê³„

```java
@Entity
public class Member {
	@Embedded Address address;  // ì„ë² ë””ë“œ íƒ€ì…
	@Embedded PhoneNumber phoneNumber;  // ì„ë² ë””ë“œ íƒ€ì…
}
```

```java
@Embeddable
public class Address {
    private String city;
    private String street;
    @Embedded 
	private Zipcode zipcode;  // ì„ë² ë””ë“œ íƒ€ì…
}
```

```java
@Embeddable
public class Zipcode {
    private String zip;
    private String plusFour;
}
```

```java
@Embeddable
public class PhoneNumber {
    private String areaCode;
    private String localNumber;
	@ManyToOne
	private PhoneServiceProvider provider: // ì—”í‹°í‹° ì°¸ì¡°
}
```

```java
@Entity
public class PhoneServiceProvider {
	@Id
	private String name;
}
```

### @AttributeOverride: ì†ì„±ì¬ì •ì˜

```java
@Entity
public class Member {

    @Id
    @GeneratedValue
    private Long id;
    private String name;
    private int age;
    
    // ì§‘ ì£¼ì†Œë¥¼ í‘œí˜„
	@Embedded
    private Address homeAddress;

	// íšŒì‚¬ ì£¼ì†Œë¥¼ í‘œí˜„
	@Embedded
	@AttributeOverrides({
			@AttributeOverride(name="city", column=@Columnn(name = "COMPANY_CTIY")),
			@AttributeOverride(name="street", column=@Columnn(name = "COMPANY_STREET")),
			@AttributeOverride(name="zipcode", column=@Columnn(name = "COMPANY_ZIPCODE"))
	})
    private Address companyAddress;

	// ê·¼ë¬´ê¸°ê°„ì„ í‘œí˜„
	@Embedded
	private Period workPeriod;
}
```

- ì»¬ëŸ¼ëª…ì´ ì¤‘ë³µë˜ì–´ ì»¬ëŸ¼ëª…ì„ ì¬ì •ì˜í•˜ëŠ” ê²½ìš° ì‚¬ìš©
- @AttributeOverrides ì„¤ì •ì€ ì—”í‹°í‹°ì— ì„¤ì •í•´ì•¼ í•¨
- ì„ë² ë””ë“œ íƒ€ì…ì´ nullì´ë©´ ì»¬ëŸ¼ ê°’ì€ ëª¨ë‘ nullë¡œ ì„¤ì •

### ê°’ íƒ€ì…ê³¼ ë¶ˆë³€ ê°ì²´

- ì„ë² ë””ë“œ íƒ€ì…ì„ ì—¬ëŸ¬ ì—”í‹°í‹°ì—ì„œ ê³µìœ í•˜ë©´ ì•ˆë¨
- ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ê³  ìˆê¸°ë•Œë¬¸ì— ë‘˜ ë‹¤ update ì¿¼ë¦¬ê°€ ë°œìƒ

### ê°’ íƒ€ì… ë³µì‚¬

- ê°’ì„ ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ë©´ ê³µìœ  ì°¸ì¡°ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¶€ì‘ìš©ì„ í”¼í•  ìˆ˜ ìˆë‹¤!
- ìë°”ì˜ ê¸°ë³¸ íƒ€ì…ì€ í•­ìƒ ë³µì‚¬í•´ì„œ ê°’ì„ ì „ë‹¬í•œë‹¤. í•˜ì§€ë§Œ ê°ì²´ëŠ” ì°¸ì¡° ê°’ì„ ì „ë‹¬í•˜ê¸° ë•Œë¬¸ì— ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•˜ê²Œ ëœë‹¤.

```java
Address a = new Address("Old");
Address b = a.clone(); // í•­ìƒ ë³µì‚¬ë¥¼ í†µí•´ ì „ë‹¬
```

- ê·¼ë³¸ì ìœ¼ë¡œ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²•ì€ ê°ì²´ì˜ ê°’ì„ ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.
    - setterë¥¼ ëª¨ë‘ ì œê±°!

### ë¶ˆë³€ ê°ì²´

- ê°’ íƒ€ì… ë³µì‚¬ë¡œ ì¸í•´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¶€ì‘ìš©ì„ ì›ì²œ ì°¨ë‹¨í•´ë³´ì.
- í•´ê²°ì±…ì€ ë°”ë¡œ immutable Object (ë¶ˆë³€ ê°ì²´) ì‚¬ìš©

```java
@Embeddable
public class Address {
    private String city;

	protected Address() {}

	public Address(String city) {
			this.city = city;
	}

	public String getCity() {
			return city;
	}

	// setter ì ˆëŒ€ ìƒì„± ê¸ˆì§€!
}
```

```java
Address a = new Address("Old");

// ìƒì„±ìë¥¼ í†µí•´ ìƒˆë¡œìš´ ê°ì²´ ìƒì„±
Address b = new Address(a.getCity());
```

<aside>
ğŸ’¡ Integer, String ìë°”ê°€ ì œê³µí•˜ëŠ” ëŒ€í‘œì ì¸ ë¶ˆë³€ ê°ì²´ë‹¤!

</aside>

- ë¶ˆë³€ ê°ì²´ ì‚¬ìš©ìœ¼ë¡œ ì°¸ì¡°ë¥¼ í†µí•œ ê³µìœ ë¥¼ ë§‰ì„ ìˆ˜ ìˆë‹¤.

### ê°’ íƒ€ì…ì˜ ë¹„êµ

- ë™ì¼ì„± ë¹„êµ : ì¸ìŠ¤í„´ìŠ¤ì˜ ì°¸ì¡°ê°’ì„ ë¹„êµ, == ì‚¬ìš©
- ë™ë“±ì„± ë¹„êµ : ì¸ìŠ¤í„´ìŠ¤ì˜ ê°’ì„ ë¹„êµ, equals() ì‚¬ìš©
- ê°’ íƒ€ì…ì„ ë¹„êµí•  ë•ŒëŠ” equals(), hashCode()ë¥¼ ì¬ì •ì˜í•˜ì—¬ ê°’ì„ ë¹„êµí•˜ì!

<aside>
ğŸ’¡ ìë°”ì—ì„œ equals()ë¥¼ ì¬ì •ì˜í•˜ë©´ hashCode()ë„ ì¬ì •ì˜í•˜ëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ í•´ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” ì»¬ë ‰ì…˜(HashSet, HashMap)ì´ ì •ìƒ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

</aside>

### ê°’ íƒ€ì… ì»¬ë ‰ì…˜

```java
@Entity
public class Member {

    @Id
    @GeneratedValue
    private Long id;

    @Embedded
    private Address address;

    @ElementCollection
    @CollectionTable(name = "FAVORITE_FOODS", joinColumns = @JoinColumn(name = "MEMBER_ID"))
    @Column(name = "FOOD_NAME") // ì»¬ëŸ¼ì´ í•˜ë‚˜ì¸ ê²½ìš° ì»¬ëŸ¼ëª… ì§€ì • ê°€ëŠ¥
    private Set<String> favoriteFoods = new HashSet<>();

    @ElementCollection
    @CollectionTable(name = "ADDRESS", joinColumns = @JoinColumn(name = "MEMBER_ID"))
    private Set<String> addressHistory = new HashSet<>();
}
```

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì¼ë¸”ì€ ì»¬ëŸ¼ì•ˆì— ì»¬ë ‰ì…˜ì„ í¬í•¨í•  ìˆ˜ ì—†ë‹¤.
- ë³„ë„ì˜ í…Œì´ë¸”ì„ ì¶”ê°€í•˜ê³  @CollectionTable ë§¤í•‘í•˜ì!

<aside>
ğŸ’¡ @CollectionTableë¥¼ ìƒëµí•˜ë©´ ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•´ì„œ ë§¤í•‘í•œë‹¤. ê¸°ë³¸ê°’: (ì—”í‹°í‹°ì´ë¦„)_(ì»¬ë ‰ì…˜ ì†ì„±ì´ë¦„). ì˜ˆë¥¼ë“¤ì–´ Member ì—”í‹°í‹°ì˜ addressHlistoryëŠ” Member_addressHistory í…Œì´ë¸”ê³¼ ë§¤í•‘í•œë‹¤.

</aside>

### ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ì‚¬ìš©

```java
// ê¸°ë³¸ê°’ íƒ€ì… ì»¬ë ‰ì…˜ (String)
member.getFavoriteFoods().add("ì¹˜í‚¨");
member.getFavoriteFoods().add("í”¼ì");

// ì„ë² ë””ë“œ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ (Address)
member.getAddressHistory().add(new Address("newAddress"));

// ì˜ì†í™”
em.persist(member);
```

- member ì—”í‹°í‹°ë§Œ ì˜ì†í™” í•˜ë”ë¼ë„ ê°’ íƒ€ì…ì´ í•¨ê»˜ ì €ì¥í•œë‹¤.
- ìœ„ì˜ ì˜ˆì œì˜ ê²½ìš° ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ì˜ ìˆ˜ëŠ”?
    - member 1ë²ˆ
    - member.favoriteFoods 2ë²ˆ
    - member.addressHistory 1ë²ˆ

<aside>
ğŸ’¡ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì€ ì˜ì†ì„± ì „ì´(Cascade) +ê³ ì•„ ê°ì²´ ì œê±°(ORPHAN REMOVE) ê¸°ëŠ¥ì„ í•„ìˆ˜ë¡œ ê°€ì§„ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.

</aside>

- @ElementCollection(fetch = FetchType.LAZY) ì„¤ì •ì„ í†µí•´ ì§€ì—° ë¡œë”©ì„ ì§€ì›í•œë‹¤.

### ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì˜ ì œì•½ì‚¬í•­

- ì‹¤ë¬´ì—ì„œëŠ” ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì´ ë§¤í•‘ëœ í…Œì´ë¸”ì— ë°ì´í„°ê°€ ë§ë‹¤ë©´ ê°’ íƒ€ì… ëŒ€ì‹ ì— ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ê³ ë ¤í•˜ì!
    - ê°’ íƒ€ì…ì˜ ê°’ì´ ë³€ê²½ë˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì— ìˆëŠ” ì›ë³¸ ë°ì´í„°ë¥¼ ì°¾ê¸° ì–´ë µë‹¤.

```java
@OneToMany(cascade = CascadeType.ALL, orphanRemoval = true)
@JoinColumn(name = "member_id")
private List<Address> addressHistory = new ArrayList<>();
```

## ê°’ íƒ€ì… ì •ë¦¬

- ì—”í‹°í‹° íƒ€ì…
    - ì‹ë³„ìê°€ ì¡´ì¬í•˜ê¸° ë•Œë¬¸ì— ì‹ë³„ìë¡œ êµ¬ë³„í•  ìˆ˜ ìˆë‹¤.
    - ìƒëª…ì£¼ê¸°(ì˜ì†í™”, ë¹„ì˜ì†í™”)
    - ì°¸ì¡° ê°’ì„ í†µí•´ ê³µìœ í•  ìˆ˜ ìˆë‹¤.
- ê°’ íƒ€ì…
    - ì‹ë³„ìê°€ ì—†ë‹¤.
    - ìƒëª…ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì— ì˜ì¡´í•œë‹¤.
    - ì°¸ì¡°ë¥¼ í†µí•œ ê³µìœ í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì•ˆì „í•˜ë‹¤.(ë¶ˆë³€ ê°ì²´ë¥¼ ì‚¬ìš©)
    
    


ğŸ’¡ ì´ ê¸€ì€ ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë°(ê¹€ì˜í•œ) ì±…ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
